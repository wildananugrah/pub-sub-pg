# User CRUD API with Separate Read/Write Databases

Express.js application with CRUD operations for user management using separate PostgreSQL databases for read and write operations.

## Architecture

- **Write Database**: Port 6000 (CREATE, UPDATE, DELETE operations)
- **Read Database**: Port 6001 (SELECT operations)

## Setup

1. Install dependencies:
```bash
npm install
```

2. Configure environment variables:
```bash
cp .env.example .env
```

3. Create the users table in both databases:
```bash
psql -h localhost -p 6000 -U postgres -f ../create_users_table.sql
psql -h localhost -p 6001 -U postgres -f ../create_users_table.sql
```

4. Start the server:
```bash
npm start
# or for development with auto-reload
npm run dev
```

## API Endpoints

### Health Check
- `GET /health` - Check database connections

### User Operations

#### Read Operations (from port 6001)
- `GET /api/users` - Get all users
- `GET /api/users/:id` - Get user by ID

#### Write Operations (to port 6000)
- `POST /api/users` - Create new user
  ```json
  {
    "username": "john_doe",
    "email": "john@example.com",
    "password": "securepassword",
    "first_name": "John",
    "last_name": "Doe"
  }
  ```

- `PUT /api/users/:id` - Update user
  ```json
  {
    "email": "newemail@example.com",
    "first_name": "Updated Name"
  }
  ```

- `DELETE /api/users/:id` - Delete user

## Testing with curl

### Create a user:
```bash
curl -X POST http://localhost:3000/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123",
    "first_name": "Test",
    "last_name": "User"
  }'
```

### Get all users:
```bash
curl http://localhost:3000/api/users
```

### Get user by ID:
```bash
curl http://localhost:3000/api/users/{user-id}
```

### Update user:
```bash
curl -X PUT http://localhost:3000/api/users/{user-id} \
  -H "Content-Type: application/json" \
  -d '{
    "email": "updated@example.com"
  }'
```

### Delete user:
```bash
curl -X DELETE http://localhost:3000/api/users/{user-id}
```

## Features

- Separate read/write database connections
- Password hashing with bcrypt
- UUID primary keys (generated by database)
- Automatic updated_at timestamp updates
- Input validation
- Error handling
- CORS enabled